import rateLimit from "express-rate-limit";

const oneSec = 1000;
const oneMin = 60 * oneSec;
const oneHour = 60 * oneMin;
const oneDay = 24 * oneHour;

// Max 3 login attempts in 5 mins.
export const loginLimiter = rateLimit({
  windowMs: 5 * oneMin, // 5 minutes
  limit: 3,
  message: {
    result: "error",
    message:
      "Too many continuous failed login attempts. Try again in 5 minutes.",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

//reset the limits once the user successfully logins.
export const resetLoginLimiter = (ip) => {
  loginLimiter.resetKey(ip);
};

// Max 1 task additions/deleteAll in 2 seconds
export const taskAddDeleteAllLimiter = rateLimit({
  windowMs: 2 * oneSec,
  limit: 1,
  message: {
    result: "error",
    message: "You are adding or deleting tasks way too fast!",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Max 10 task delete/edit in 5 seconds
export const taskDeleteEditLimiter = rateLimit({
  windowMs: 5 * oneSec,
  limit: 10,
  message: {
    result: "error",
    message: "You are editing or deleting tasks way too fast!",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Max 1 user registration in 5 secs.
export const userRegLimiter = rateLimit({
  windowMs: 5 * oneSec,
  limit: 1,
  message: {
    result: "error",
    message: "You are trying to register new users way too many times",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

//reset the limits once the user successfully registers.
export const resetRegLimiter = (ip) => {
  userRegLimiter.resetKey(ip);
};

// Max 1 refresh per 3 secs.
export const refreshLimiter = rateLimit({
  windowMs: 3 * oneSec,
  limit: 1,
  message: {
    result: "error",
    message: "You are trying to refresh the page way too many times",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Max 3 profile update per 10 secs.
export const profileUpdateLimiter = rateLimit({
  windowMs: 10 * oneSec,
  limit: 3,
  message: {
    result: "error",
    message: "You are trying to update the profile way too many times",
  },
  standardHeaders: true,
  legacyHeaders: false,
});
